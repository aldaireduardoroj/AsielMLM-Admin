<nz-card  style="border: 0;">

  <nz-card-tab class="tab-makerplace">
    <nz-tabset nzSize="large" [(nzSelectedIndex)]="tabIndex" [nzTabBarExtraContent]="extraTemplate">
      <nz-tab nzTitle="Tienda">
        <div class="row justify-content-between">
          <div class="col-lg-9 col-md-6 col-12">
            <p class="font-size-18 text-gray-7">Compra nuestros productos naturales a precios especiales. <br>
              Descuentos exclusivos solo para socios</p>
          </div>
          <div class="col-lg-3 col-md-6 col-12">
            <div class="d-flex flex-column">
              <div class="d-flex flex-row align-items-center justify-content-between m-b-10">
                <p class="text-gray-7 m-0 font-size-14 p-r-20">Puntos por compras personales:</p>
                <span class="d-inline-block text-gray-8 border rounded-lg font-size-12 text-center" style="border-color: #E2E8F0 !important; padding: 0 6px; min-width: 30px; line-height: 1.9;">{{ totalPointsPersonal }}</span>
              </div>
              <div class="d-flex flex-row align-items-center justify-content-between">
                <p class="text-gray-7 m-0 font-size-14 p-r-20">Puntos por compras globales 2%:</p>
                <span class="d-inline-block text-gray-8 border rounded-lg font-size-12 text-center " style="border-color: #E2E8F0 !important; padding: 0 6px; min-width: 30px; line-height: 1.9;">{{ totalPointsPersonalGlobal | number : '1.2' }}</span>
              </div>
            </div>
          </div>
        </div>



        <div class="d-flex justify-content-between align-items-end m-b-20 p-t-10">
          <div>
            <p class="font-size-13 m-0 text-uppercase "> {{ userModel?.name ?? "" }}/
              <ng-container *ngIf="userModel?.payment?.payment_order != null">
                {{ userModel?.payment?.payment_order?.pack?.title }} -
                <span class="d-inline-flex align-items-center">
                  <span style="color: #215EE9;" *ngIf="userModel?.payment?.state == CONSTANTS.PAYMENT_ORDER.PAGADO">ACTIVO</span>
                  <ng-container *ngIf="userModel?.payment?.state == CONSTANTS.PAYMENT_ORDER.TERMINADO">
                    <span class="text-gray-7" >DESACTIVO -</span>&nbsp;<a href="javascript: void(0);"><span style="color: #00B517;" >RENOVAR</span></a>
                  </ng-container>
                  &nbsp;&nbsp;&nbsp;<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="4" cy="4" r="4" fill="#00B517"/>
                  </svg></span>
              </ng-container>
              <ng-container *ngIf="userModel?.payment?.payment_order == null">
                <span class="d-inline-flex align-items-center">
                  SIN PLAN&nbsp;&nbsp;&nbsp;<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="4" cy="4" r="4" fill="#979797"/>
                    </svg>
                </span>

              </ng-container>
            </p>
          </div>



          <div>
            <div class="text-center m-b-10">
              <nz-badge nzSize="default" [nzCount]="countProduct">
                <i nz-icon nzType="shopping-cart" nzTheme="outline" class="font-size-30 pointer" (click)="quickViewToggle()"></i>
              </nz-badge>
            </div>
            <button nz-button nzType="primary" nzSize="small" (click)="onPayment()">&nbsp;&nbsp;Pagar&nbsp;&nbsp;</button>
          </div>
        </div>

        <nz-row class="m-b-40 ">
          <ng-container *ngFor="let product of productList; let i = index" >
            <nz-col [nzXl]="8" [nzLg]="12" [nzSm]="24" [nzXs]="24" class="m-b-10 p-20">
              <div class="rounded bg-white shadow--product m-b-20 product--image text-center">
                <img nz-image [nzSrc]="env.hostUrl + '/storage/' + product.file_image?.path" alt="" class="img-fluid rounded">
              </div>
              <div class="m-b-20">
                <p class="m-b-10 font-size-14 notranslate "><b>{{ product.title }}</b> - <span style="color: #A6A6A6;"><b>{{ product.points }} Ptos</b></span></p>
                <p class="font-size-14"><span style="color: #A6A6A6;">Precio Regular :</span> &nbsp;&nbsp;<b>{{ product.price | number : '1.0'}} Soles</b></p>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <div class="text-black d-flex align-items-center p-10" style="background-color: #F0F0F0; border-radius: 20px;">
                  <i nz-icon nzType="minus" nzTheme="outline" (click)="onAddQuantity( i , -1 )" class="p-r-10 p-l-10 pointer"></i>
                  <span class="notranslate">{{ product?.quantity ?? 0 }}</span>
                  <i nz-icon nzType="plus" nzTheme="outline" (click)="onAddQuantity( i , 1 )" class="p-r-10 p-l-10 pointer"></i>
                </div>
                <div>
                  <button nz-button nzType="primary" nzSize="small" style="border-radius: 20px;" (click)="onPayment()">&nbsp;&nbsp;Comprar&nbsp;&nbsp;</button>
                </div>
              </div>
            </nz-col>
          </ng-container>

        </nz-row>
      </nz-tab>
      <nz-tab nzTitle="Pedidos pendientes">
        <app-table-payment-product-order [searchLoader]="eventSearch" [queryParams]="queryParams"></app-table-payment-product-order>
      </nz-tab>
    </nz-tabset>

    <ng-template #extraTemplate>

    </ng-template>
  </nz-card-tab>

  <ng-container *ngIf="tabIndex == 0">

  </ng-container>

  <ng-container *ngIf="tabIndex == 1">

  </ng-container>

  <nz-row class="m-b-20 p-t-30">
    <nz-col [nzXs]="24" class="m-b-10">
      <div class="text-center rounded-lg p-10" style="background-color: #F5F7FA;">
        <h3 style="color: #717171;" class="fs-15">Si estás afiliado a algún plan de distribución aplicas a descuentos exclusivos</h3>
        <a href="#" download target="_blank" class="fs-18"><h2>Mar información +</h2></a>
      </div>
    </nz-col>
  </nz-row>
</nz-card>

<nz-drawer [nzWidth]="280" nzTitle="Carrito" [nzClosable]="false"
  [nzVisible]="quickViewVisible"
  nzPlacement="right"
  (nzOnClose)="quickViewToggle()"
  [nzFooter]="footerDrawer">
  <ng-container *nzDrawerContent>
    <nz-row class="m-b-20">
      <nz-col [nzXs]="24" class="m-b-20">
        <ng-container *ngFor="let product of cartList; let i = index">
          <div class="d-flex align-items-center justify-content-between position-relative">
            <div class="rounded bg-white shadow--product m-b-20" style="padding: 3px; width: 60px;">
              <img [src]="env.hostUrl + '/storage/' + product.file_image?.path" alt="" class="img-fluid rounded">
            </div>
            <div class="w-100 p-l-10">
              <p class="m-0 p-r-20 notranslate"><b>{{ product.title }}</b></p>
              <p class="m-0 notranslate"><span style="color: #A6A6A6;"><b>{{ product.points }} Ptos</b></span></p>
              <p class="m-0 notranslate"><span style="color: #A6A6A6;">Cantidad :</span> &nbsp;&nbsp;<b>{{ product.quantity }}</b></p>
            </div>
            <a href="javascript: void(0);" (click)="onRemove(i)" class="position-absolute" style="top: 0; right: 0;"><i nz-icon nzType="delete" nzTheme="fill" class="text-danger"></i></a>
          </div>
          <div class="text-right">
            <h4 class="notranslate"><b>S/. {{ (product.quantity * product.priceNew) | number: '1.2' }}</b></h4>
          </div>
          <hr style="margin: 0;">
        </ng-container>

      </nz-col>
      <nz-col [nzXs]="24" class="m-b-10">
        <div class="text-right">
          <h3><b>TOTAL: S/. {{ totalBuy | number: '1.2' }}</b></h3>
        </div>
      </nz-col>
      <nz-col [nzXs]="24" class="m-b-10">

      </nz-col>

    </nz-row>
  </ng-container>

  <ng-template #footerDrawer>
    <div class="w-100">
      <button nz-button nzType="primary" nzBlock (click)="onPayment()">&nbsp;&nbsp;Pagar&nbsp;&nbsp;</button>
    </div>
  </ng-template>
</nz-drawer>
